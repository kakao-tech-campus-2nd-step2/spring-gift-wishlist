<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Edit Product</title>
</head>
<body>
<h2>Edit Product</h2>
<form id="updateForm" th:action="@{/api/products/{id}(id=${product.id})}"
      th:object="${product}" method="post">
  <input type="hidden" th:field="*{id}">
  <label>Name:</label>
  <input type="text" id="name" th:field="*{name}">
  <label>Price:</label>
  <input type="number" id="price" th:field="*{price}">
  <label>Image URL:</label>
  <input type="text" id="imageUrl" th:field="*{imageUrl}">
  <!-- PUT 요청을 위해 _method를 설정 -->
  <input type="hidden" name="_method" value="PUT">
  <button type="button" onclick="submitUpdateForm()">Update</button>
</form>

<script th:inline="javascript">
    function submitUpdateForm() {
        var productId = /*[[${product.id}]]*/ null; // Thymeleaf로 product.id 값을 가져옴
        var name = document.getElementById('name').value;
        var price = document.getElementById('price').value;
        var imageUrl = document.getElementById('imageUrl').value;

        var formData = {
            id: productId,
            name: name,
            price: price,
            imageUrl: imageUrl
        };

        fetch(`/api/products/${productId}`, {
            method: 'PUT', // PUT으로 변경
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => {
            if (response.ok) {
                window.location.href = '/admin/product/list'; // 수정 성공 시 목록 페이지로 이동
            } else {
                alert('상품 정보를 업데이트 하는데 에러가 발생했습니다.');
            }
        })
        .catch(error => {
            console.error('Error updating product:', error);
            alert('상품 정보를 업데이트 하는데 에러가 발생했습니다.');
        });
    }

</script>

</body>
</html>
