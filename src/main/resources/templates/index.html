<!DOCTYPE html>
<html lang="KR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 목록</title>
    <link rel="stylesheet" href="/index_style.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="/index_ajax.js"></script>

</head>
<body>
<h1>Administrator Page</h1>
<div class="form-inline">
    <label for="id">Id:</label>
    <input type="text" id="id" name="id" required>

    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>

    <label for="price">Price:</label>
    <input type="number" id="price" name="price" required>

    <label for="imageUrl">Image URL:</label>
    <input type="text" id="imageUrl" name="imageUrl" required>

    <input type="button" id="request" value="추가">
</div>
<table id="product-table">
    <thead>
    <tr>
        <th scope="col">Id</th>
        <th scope="col">Name</th>
        <th scope="col">Price</th>
        <th scope="col">Image</th>
        <th scope="col">Option</th>
    </tr>
    </thead>
    <tbody id="product-tbody">
    <!-- AJAX를 통해 데이터를 로드 -->
    </tbody>
</table>
</body>
<script>
    $(document).ready(function() {
// 페이지 로드 시 AJAX를 통해 데이터 가져오기
        $.ajax({
            url: '/api/products',
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                var tbody = $('#product-tbody');
                tbody.empty(); // 초기화

                // 데이터에 따라 테이블 행을 생성
                data.forEach(function(product) {
                    // 한 행의 내용
                    var row = `
                        <tr>
                            <td>${product.id}</td>
                            <td>${product.name}</td>
                            <td>${product.price}</td>
                            <td><img src="${product.imageUrl}" alt="image"/></td>
                            <td>
                                <a href="#" onclick="deleteFunction(${product.id})">삭제</a>
                                <a href="/api/products/modForm/${product.id}">수정</a>
                            </td>
                        </tr>
                    `;
                    tbody.append(row);
                });
            },
            error: function(data) {
                alert('something wrong');
            }
        });
    });
    $("#request").click(function(){
        var product ={
            id : $("#id").val(),
            name : $("#name").val(),
            price : $("#price").val(),
            imageUrl : $("#imageUrl").val()
        }

        $.ajax({
            type : "POST",
            url : "api/products",
            data : product,
            success : function(res){
                var tbody = $('#product-tbody');
                var row = `
                            <tr>
                                <td>${product.id}</td>
                                <td>${product.name}</td>
                                <td>${product.price}</td>
                                <td><img src="${product.imageUrl}" alt="image"/></td>
                                <td>
                                    <a href="#" onclick="deleteFunction(${product.id})">삭제</a>
                                    <a href="/api/products/modForm/${product.id}">수정</a>
                                </td>
                            </tr>
                        `;
                tbody.append(row);
            },
            error : function(error){
                alert("something wrong : " + error.code);
            }
        })
    })
    function deleteFunction(id){
        $.ajax({
            type: "DELETE",
            url: "api/products/" + id,
            success : function(res){
                $('#product-table').find('tr[data-id="' + id + '"]').remove();
                alert("Product with ID " + id + " has been deleted.");
                location.reload();
            },
            error : function(error){
                alert("something wrong : " + error.code);
            }
        })
    }
</script>
</html>
